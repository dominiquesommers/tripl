@if (map(); as map) {
  <app-map-search [map]="map"></app-map-search>
}

<div #mapContainer id="map-container"
     class="map-container"
     [class.visible]="isMapVisible()">
</div>

@if (tripService.selectedVisit(); as selectedVisit) {
  <app-visit-popup
    [visit]="selectedVisit"
    (onSave)="handlePlaceSave($event)"
    (onDelete)="handleVisitDelete($event)">
  </app-visit-popup>
}

@if (!tripService.selectedVisit() && tripService.selectedRoute(); as selectedRoute) {
  <app-route-popup
    [route]="selectedRoute"
    (onSave)="handleRouteSave($event)"
    (onDelete)="handleRouteDelete($any($event))">
  </app-route-popup>
}

@if (!tripService.selectedVisit() && !tripService.selectedRoute() && !tripService.hoveredRoute() && tripService.hoveredPlace()) {
  <app-place-tooltip [place]="tripService.hoveredPlace"></app-place-tooltip>
}

@if (!tripService.selectedVisit() && !tripService.selectedRoute() && !tripService.hoveredPlace() && tripService.hoveredRoute()) {
  <app-route-tooltip [route]="tripService.hoveredRoute"></app-route-tooltip>
}

<div style="position: absolute; left: -9999px;">
  @if (tripService.trip(); as trip) {
    @for (place of trip.placesArray(); track place.id) {
      <app-place-marker
        [place]="place"
        [hoveredPlace]="tripService.hoveredPlace"
        [selectedVisit]="tripService.selectedVisit"
        [zoom]="zoom">
      </app-place-marker>
    }
  }
</div>
